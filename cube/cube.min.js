var CUBE={view:function(c){var e=[90,0,0,0,0,-90],k=[0,0,90,180,-90,-360],g={},d=document.createElement("div"),b=0,m=0,l=(new Date).getTime(),r=l,s=!0,n="",p,t=function(){var a=window.getComputedStyle(d,null).getPropertyValue("-webkit-transform"),a=a.replace(/^\w*\(/,"").replace(")","");return a.split(/\s*,\s*/)},h=function(){var a=t()[0],c=t()[2],a=180*Math.acos(a)/Math.PI;0<c&&(a=360-a);return a},y=function(a){var f=c.datasource.el_for_side(a),b=c.datasource.side_length()/2;f.style.position="absolute";
f.style.width=c.datasource.side_length()+"px";f.style.height=c.datasource.side_length()+"px";f.style.opacity=c.datasource.opacity_for_side(a);f.style.webkitTransform="rotateX("+e[a]+"deg) rotateY("+k[a]+"deg) translateZ("+b+"px)";f.dataset.side=a;f.addEventListener("load",c.delegate.did_load_side(a));return f},u=function(a){a=a.touches[0].clientX;var c=a-b,e=h();r=l;l=(new Date).getTime();b=a;d.style.webkitTransition="-webkit-transform 1ms linear";d.style.webkitAnimation="";d.style.webkitTransform=
"rotateY("+(e+c)+"deg)";m=h()-c},v=function(){var a=h()-m,f=l-r,f=0!==f?a/f:0;0.01>Math.abs(f)?c.delegate.did_click_on_side(event.target.dataset.side):(d.removeEventListener("touchmove",u),d.removeEventListener("touchend",v),s=0<f,a=100*Math.abs(f),f=80*f+h(),d.style.webkitTransition="-webkit-transform "+a+"ms ease-out",d.style.webkitTransform="rotateY("+f+"deg)",b=0,setTimeout(function(){d.style.webkitTransition="";p(h())},a))},q=function(a){b=a.touches[0].clientX;d.style.webkitTransform="rotateY("+
h()+"deg)";d.style.webkitAnimationName="none !important";d.style.webkitAnimationPlayState="paused";m=h();d.addEventListener("touchmove",u);d.addEventListener("touchend",v);d.removeEventListener("touchstart",q)},w=function(){if(d.id)return d;var a;d.id="cube";d.style.height=c.datasource.side_length()+"px";d.style.width=c.datasource.side_length()+"px";d.style.position="relative";d.style.margin="0 auto";d.style.webkitTransformStyle="preserve-3d";d.addEventListener("touchstart",q);for(a=0;6>a;a+=1)d.appendChild(y(a));
return d},z=function(){var a;if(c.datasource.image_url_for_background())return a=document.createElement("img"),a.src=c.datasource.image_url_for_background(),a.style.width="100%",a.style.height="auto",a.style.position="absolute",a.style.opacity=c.datasource.opacity_for_background(),a},x=function(){d.style.paddingTop=window.innerHeight/2-c.datasource.side_length()/2+"px"},A=function(a){a=a.target.parentNode;a.parentNode.removeChild(a)};p=function(a){d.style.webkitTransition="";var b;b=a||0;var e=s?
b+359:b-361;a="rotate-"+(new Date).getTime();b="@-webkit-keyframes "+a+" {from {-webkit-transform: rotateY("+b+"deg);} to {-webkit-transform: rotateY("+e+"deg);}}";document.styleSheets&&0<document.styleSheets.length?document.styleSheets[0].insertRule(b,document.styleSheets.length-1):(e=document.createElement("style"),e.innerHTML=b,document.getElementsByTagName("head")[0].appendChild(e));n=a;d.style.webkitAnimation=n+" "+c.datasource.rotation_period()+" infinite linear";d.style.webkitAnimationName=
n+" !important";d.style.webkitAnimationPlayState="running";d.addEventListener("touchstart",q)};g.append=function(a){a||(a=document.body);c.datasource.image_url_for_background()&&a.appendChild(z());var b=document.createElement("div");a.style.overflow="hidden";b.id="container";b.style.webkitPerspective="800";b.style.webkitPerspectiveOrigin="50% 50px";b.style.webkitTransform="scale(0.75,0.75)";b.appendChild(w());a.appendChild(b);x();window.addEventListener("resize",function(){x()});if(b=c.datasource.el_for_close_button())b.addEventListener("touchstart",
A),a.appendChild(b)};g.get_cube_el=w;g.resume=p;return g},controller:function(c){var e={},k=0,g=CUBE.view({datasource:e,delegate:e}),d=function(){if(c.trackingPixelURL){var b=document.createElement("img");b.src=c.trackingPixelURL;b.style.display="none";document.body.appendChild(b)}};c=c||{};e.side_length=function(){if(!c.sideLength)return 250;if("number"!==typeof c.sideLength)throw{name:"TypeError",message:"sideLength must be a number"};return c.sideLength};e.start=function(){window.addEventListener("touchstart",
function(b){b.preventDefault()});g.append(document.body);d()};e.el_for_side=function(b){var d=document.createElement("div"),e=d.style,g;if(c.imageURLs&&c.imageURLs[b]){if("string"!==typeof c.imageURLs[b])throw{name:"TypeError",message:"imageURLs["+b+"] must be a string"};g=c.imageURLs[b]}else g="http://placehold.it/500x500";e.backgroundImage="url("+g+")";d.style.backgroundSize="100%";e=d.style;if(c.backgroundColors&&c.backgroundColors[b]){if("string"!==typeof c.backgroundColors[b])throw{name:"TypeError",
message:"spec.backgroundColors["+b+"] must be a string"};b=c.backgroundColors[b]}else b="black";e.backgroundColor=b;return d};e.el_for_close_button=function(){if(c.showCloseButton){var b=document.createElement("img");b.style.position="absolute";b.style.top="10px";b.style.left="10px";b.style.width="22px";b.src="close.png";return b}};e.rotation_period=function(){if(!c.rotationPeriod)return"10s";if("string"!==typeof c.rotationPeriod)throw{name:"TypeError",message:"rotationPeriod must be a string"};return c.rotationPeriod};
e.did_click_on_side=function(b){if(c.destURLs[b]){if("string"!==typeof c.destURLs[b])throw{name:"TypeError",message:"spec.destURLs["+b+"] must be a string"};b=c.destURLs[b];var d=document.createElement("a"),e=document.createEvent("HTMLEvents");d.href=b;d.target="_blank";e.initEvent("click",!0,!0);d.dispatchEvent(e)}};e.did_load_side=function(){k+=1;5===k&&g.resume(0)};e.image_url_for_background=function(){if(c.backgroundImageURL&&"string"!==typeof c.backgroundImageURL)throw{name:"TypeError",message:"backgroundImageURL must be a string"};
return c.backgroundImageURL};e.opacity_for_background=function(){if(c.backgroundImageOpacity&&"number"!==typeof c.backgroundImageOpacity)throw{name:"TypeError",message:"backgroundImageOpacity must be a number"};return c.backgroundImageOpacity||1};e.opacity_for_side=function(){if(c.sideOpacity&&"number"!==typeof c.sideOpacity)throw{name:"TypeError",message:"sideOpacity must be a number"};return c.sideOpacity||1};return e}};
